# Auth0 + Rails + Next.js Authentication Demo

Auth0„Çí‰ΩøÁî®„Åó„ÅüË™çË®º„Ç∑„Çπ„ÉÜ„É†„ÅÆÂÆüË£Ö‰æã„ÄÇRails API„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„Å®Next.js„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„ÅßÊßãÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ

## üöÄ Features

- **Auth0 Authentication**: „É≠„Ç∞„Ç§„É≥/„É≠„Ç∞„Ç¢„Ç¶„ÉàÊ©üËÉΩ
- **JWT Token Validation**: Rails API„ÅåAuth0 JWT„Éà„Éº„ÇØ„É≥„ÇíÊ§úË®º
- **Protected Routes**: Ë™çË®º„ÅåÂøÖË¶Å„Å™„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éö„Éº„Ç∏
- **Public & Private Endpoints**: Ë™çË®º„ÅÆÊúâÁÑ°„Åß‰Ωø„ÅÑÂàÜ„Åë„ÇãAPI„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà
- **Modern Stack**: Next.js 16 (App Router) + Rails 8 + Tailwind CSS

## üìã Prerequisites

- Node.js 18+ (with npm)
- Ruby 3.2+
- Rails 8+
- Auth0 Account (ÁÑ°Êñô„Ç¢„Ç´„Ç¶„É≥„Éà„ÅßÂèØ)

## üéØ „Éó„É≠„Ç∏„Çß„ÇØ„Éà‰ΩúÊàê„Åã„Çâ„Éá„Éó„É≠„Ç§„Åæ„Åß„ÅÆÂÆåÂÖ®„Ç¨„Ç§„Éâ

### Phase 1: Auth0„ÅÆË®≠ÂÆö

#### 1.1 Auth0„Ç¢„Ç´„Ç¶„É≥„Éà‰ΩúÊàê
1. [auth0.com](https://auth0.com) „Å´„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„ÄåSign Up„Äç
2. „ÉÜ„Éä„É≥„ÉàÂêç„ÇíÊ±∫ÂÆöÔºà‰æã: `dev-myapp`Ôºâ‚Üí `dev-myapp.auth0.com` „Å´„Å™„Çä„Åæ„Åô
3. „É™„Éº„Ç∏„Éß„É≥„ÇíÈÅ∏ÊäûÔºàÊó•Êú¨„Å™„Çâ `Asia Pacific (Sydney)` „ÅåÊúÄ„ÇÇËøë„ÅÑÔºâ

#### 1.2 ApplicationÔºà„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥Ôºâ„ÅÆ‰ΩúÊàê
1. Auth0„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ ‚Üí **Applications** ‚Üí **Create Application**
2. ÂêçÂâç: `Next.js Frontend`
3. „Çø„Ç§„Éó: **Regular Web Applications** „ÇíÈÅ∏Êäû
4. **Settings** „Çø„Éñ„Åß‰ª•‰∏ã„ÇíË®≠ÂÆö:

**ÂøÖÈ†àÈ†ÖÁõÆ:**
```
Allowed Callback URLs:
http://localhost:3000/api/auth/callback

Allowed Logout URLs:
http://localhost:3000

Allowed Web Origins:
http://localhost:3000

Allowed Origins (CORS):
http://localhost:3000
```

5. **Save Changes** „Çí„ÇØ„É™„ÉÉ„ÇØ
6. ‰ª•‰∏ã„ÅÆÊÉÖÂ†±„Çí„É°„É¢:
   - Domain: `your-tenant.auth0.com`
   - Client ID
   - Client SecretÔºà„ÄåShow„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Ë°®Á§∫Ôºâ

#### 1.3 API „ÅÆ‰ΩúÊàê
1. Auth0„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ ‚Üí **Applications** ‚Üí **APIs** ‚Üí **Create API**
2. Ë®≠ÂÆö:
   - Name: `Rails API`
   - Identifier: `https://my-rails-api` (‰ªªÊÑè„ÅÆURLÂΩ¢Âºè„ÄÅÂÆüÂú®„Åô„ÇãÂøÖË¶Å„Å™„Åó)
   - Signing Algorithm: `RS256` („Éá„Éï„Ç©„É´„Éà)
3. **Create** „Çí„ÇØ„É™„ÉÉ„ÇØ
4. **Identifier** „Çí„É°„É¢ÔºàÁí∞Â¢ÉÂ§âÊï∞„Åß‰ΩøÁî®Ôºâ

### Phase 2: Rails„Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó

#### 2.1 Rails„Éó„É≠„Ç∏„Çß„ÇØ„Éà‰ΩúÊàêÔºàÊó¢Â≠ò„ÅÆÂ†¥Âêà„ÅØ„Çπ„Ç≠„ÉÉ„ÉóÔºâ
```bash
# Rails„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅåÊó¢„Å´„ÅÇ„ÇãÂ†¥Âêà„ÅØ‰∏çË¶Å
rails new backend --api --database=sqlite3
cd backend
```

#### 2.2 ÂøÖË¶Å„Å™Gem„ÇíËøΩÂä†
`Gemfile` „Å´‰ª•‰∏ã„ÇíËøΩÂä†:
```ruby
# Use JWT for Auth0 token verification
gem "jwt"

# Load environment variables from .env file
gem "dotenv-rails", groups: [:development, :test]

# Use Rack CORS for handling Cross-Origin Resource Sharing (CORS)
gem "rack-cors"
```

#### 2.3 Gem„Çí„Ç§„É≥„Çπ„Éà„Éº„É´
```bash
bundle install
```

#### 2.4 CORSË®≠ÂÆö
`config/initializers/cors.rb` „Çí‰ΩúÊàê:
```ruby
Rails.application.config.middleware.insert_before 0, Rack::Cors do
  allow do
    origins ENV['FRONTEND_URL'] || 'http://localhost:3000'

    resource "*",
      headers: :any,
      methods: [:get, :post, :put, :patch, :delete, :options, :head],
      credentials: true
  end
end
```

#### 2.5 JWTÊ§úË®º„É©„Ç§„Éñ„É©„É™„Çí‰ΩúÊàê
`app/lib/json_web_token.rb`:
```ruby
require 'net/http'
require 'uri'

class JsonWebToken
  def self.verify(token)
    auth0_issuer = normalize_domain(ENV['AUTH0_DOMAIN'])
    
    # Auth0 tokens have trailing slash in issuer, so we need to accept both
    JWT.decode(token, nil,
              true,
              algorithms: 'RS256',
              iss: [auth0_issuer, "#{auth0_issuer}/"],
              verify_iss: true,
              aud: ENV['AUTH0_API_IDENTIFIER'],
              verify_aud: true) do |header|
      jwks_hash[header['kid']]
    end
  end

  def self.jwks_hash
    jwks_url = "#{normalize_domain(ENV['AUTH0_DOMAIN'])}/.well-known/jwks.json"
    uri = URI(jwks_url)
    
    http = Net::HTTP.new(uri.host, uri.port)
    http.use_ssl = true
    http.verify_mode = Rails.env.production? ? OpenSSL::SSL::VERIFY_PEER : OpenSSL::SSL::VERIFY_NONE
    
    request = Net::HTTP::Get.new(uri.request_uri)
    response = http.request(request)
    
    jwks_raw = response.body
    jwks_keys = Array(JSON.parse(jwks_raw)['keys'])
    Hash[
      jwks_keys.map do |k|
        [
          k['kid'],
          OpenSSL::X509::Certificate.new(
            Base64.decode64(k['x5c'].first)
          ).public_key
        ]
      end
    ]
  end

  private

  def self.normalize_domain(domain)
    return nil if domain.nil? || domain.empty?
    domain = "https://#{domain}" unless domain.start_with?('http://', 'https://')
    domain.chomp('/')
  end
end
```

#### 2.6 Ë™çË®ºConcern„Çí‰ΩúÊàê
`app/controllers/concerns/secured.rb`:
```ruby
module Secured
  extend ActiveSupport::Concern

  included do
    before_action :authenticate_request!
  end

  private

  def authenticate_request!
    auth_token
  rescue JWT::VerificationError, JWT::DecodeError => e
    Rails.logger.error "JWT Verification failed: #{e.message}"
    render json: { errors: ['Not Authenticated'] }, status: :unauthorized
  end

  def http_token
    if request.headers['Authorization'].present?
      request.headers['Authorization'].split(' ').last
    end
  end

  def auth_token
    JsonWebToken.verify(http_token)
  end
end
```

#### 2.7 „Ç≥„É≥„Éà„É≠„Éº„É©„Éº„Çí‰ΩúÊàê
```bash
# Public API„Ç≥„É≥„Éà„É≠„Éº„É©„Éº
mkdir -p app/controllers/api/v1
```

`app/controllers/api/v1/public_controller.rb`:
```ruby
class Api::V1::PublicController < ApplicationController
  def index
    render json: { message: "Hello from a public endpoint! You don't need to be authenticated to see this." }
  end
end
```

`app/controllers/api/v1/private_controller.rb`:
```ruby
class Api::V1::PrivateController < ApplicationController
  include Secured

  def index
    render json: { message: 'Hello from a private endpoint! You need to be authenticated to see this.' }
  end
end
```

#### 2.8 „É´„Éº„ÉÜ„Ç£„É≥„Ç∞Ë®≠ÂÆö
`config/routes.rb`:
```ruby
Rails.application.routes.draw do
  get "up" => "rails/health#show", as: :rails_health_check

  namespace :api do
    namespace :v1 do
      get 'private' => 'private#index'
      get 'public' => 'public#index'
    end
  end
end
```

#### 2.9 Áí∞Â¢ÉÂ§âÊï∞Ë®≠ÂÆö
`.env` „Éï„Ç°„Ç§„É´„Çí‰ΩúÊàê:
```bash
# Auth0 settings (domain without https://)
AUTH0_DOMAIN=your-tenant.auth0.com
AUTH0_API_IDENTIFIER=https://my-rails-api

# Frontend URL
FRONTEND_URL=http://localhost:3000
```

#### 2.10 „Éá„Éº„Çø„Éô„Éº„ÇπÊ∫ñÂÇô
```bash
bin/rails db:create
bin/rails db:prepare
```

#### 2.11 Rails„Çµ„Éº„Éê„ÉºËµ∑Âãï
```bash
bundle exec rails server -p 3001
```

### Phase 3: Next.js„Éï„É≠„É≥„Éà„Ç®„É≥„Éâ„ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó

#### 3.1 Next.js„Éó„É≠„Ç∏„Çß„ÇØ„Éà‰ΩúÊàê
```bash
cd ..
npx create-next-app@latest frontend --typescript --tailwind --app --use-npm
cd frontend
```

#### 3.2 Auth0„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´
```bash
npm install @auth0/nextjs-auth0 --legacy-peer-deps
```

#### 3.3 Áí∞Â¢ÉÂ§âÊï∞Ë®≠ÂÆö
`.env.local` „Éï„Ç°„Ç§„É´„Çí‰ΩúÊàê:
```bash
# Auth0 Configuration
AUTH0_DOMAIN=your-tenant.auth0.com
AUTH0_CLIENT_ID=your_client_id
AUTH0_CLIENT_SECRET=your_client_secret
AUTH0_BASE_URL=http://localhost:3000
AUTH0_AUDIENCE=https://my-rails-api

# Backend API URL
NEXT_PUBLIC_API_URL=http://localhost:3001
```

#### 3.4 Auth0 API„É´„Éº„Éà„Çí‰ΩúÊàê
`src/app/api/auth/[auth0]/route.ts`:
```typescript
import { NextRequest, NextResponse } from 'next/server';

const auth0Domain = process.env.AUTH0_DOMAIN!;
const auth0ClientId = process.env.AUTH0_CLIENT_ID!;
const auth0ClientSecret = process.env.AUTH0_CLIENT_SECRET!;
const auth0Audience = process.env.AUTH0_AUDIENCE || process.env.NEXT_PUBLIC_AUTH0_AUDIENCE;
const baseUrl = process.env.AUTH0_BASE_URL || 'http://localhost:3000';

export async function GET(
  request: NextRequest,
  { params }: { params: Promise<{ auth0: string }> }
) {
  const { auth0 } = await params;

  if (auth0 === 'login') {
    const redirectUri = `${baseUrl}/api/auth/callback`;
    const authUrl = `https://${auth0Domain}/authorize?` +
      `response_type=code&` +
      `client_id=${auth0ClientId}&` +
      `redirect_uri=${encodeURIComponent(redirectUri)}&` +
      `scope=openid profile email&` +
      `audience=${encodeURIComponent(auth0Audience || '')}`;
    
    return NextResponse.redirect(authUrl);
  }

  if (auth0 === 'logout') {
    const logoutUrl = `https://${auth0Domain}/v2/logout?` +
      `client_id=${auth0ClientId}&` +
      `returnTo=${encodeURIComponent(baseUrl)}`;
    
    const response = NextResponse.redirect(logoutUrl);
    response.cookies.delete('auth0_session');
    
    return response;
  }

  if (auth0 === 'callback') {
    const code = request.nextUrl.searchParams.get('code');
    
    if (!code) {
      return NextResponse.redirect(`${baseUrl}?error=no_code`);
    }

    try {
      const tokenResponse = await fetch(`https://${auth0Domain}/oauth/token`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          grant_type: 'authorization_code',
          client_id: auth0ClientId,
          client_secret: auth0ClientSecret,
          code,
          redirect_uri: `${baseUrl}/api/auth/callback`,
          audience: auth0Audience,
        }),
      });

      const tokens = await tokenResponse.json();

      if (!tokenResponse.ok) {
        throw new Error(tokens.error_description || 'Token exchange failed');
      }

      const response = NextResponse.redirect(baseUrl);
      response.cookies.set('auth0_session', JSON.stringify(tokens), {
        httpOnly: true,
        secure: process.env.NODE_ENV === 'production',
        sameSite: 'lax',
        maxAge: 60 * 60 * 24 * 7,
        path: '/',
      });

      return response;
    } catch (error) {
      console.error('Auth error:', error);
      return NextResponse.redirect(`${baseUrl}?error=auth_failed`);
    }
  }

  if (auth0 === 'me') {
    const session = request.cookies.get('auth0_session');
    
    if (!session) {
      return NextResponse.json({ error: 'Not authenticated' }, { status: 401 });
    }

    try {
      const tokens = JSON.parse(session.value);
      
      const userResponse = await fetch(`https://${auth0Domain}/userinfo`, {
        headers: {
          Authorization: `Bearer ${tokens.access_token}`,
        },
      });

      if (!userResponse.ok) {
        throw new Error('Failed to fetch user info');
      }

      const user = await userResponse.json();
      
      return NextResponse.json({ user, tokens });
    } catch (error) {
      console.error('User info error:', error);
      return NextResponse.json({ error: 'Failed to get user info' }, { status: 500 });
    }
  }

  return NextResponse.json({ error: 'Invalid auth route' }, { status: 404 });
}
```

#### 3.5 Â§ñÈÉ®ÁîªÂÉèË®≠ÂÆö
`next.config.ts`:
```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**.googleusercontent.com',
      },
      {
        protocol: 'https',
        hostname: '**.auth0.com',
      },
      {
        protocol: 'https',
        hostname: 's.gravatar.com',
      },
    ],
  },
};

export default nextConfig;
```

#### 3.6 „Éõ„Éº„É†„Éö„Éº„Ç∏„Çí‰ΩúÊàê
`src/app/page.tsx`:
```typescript
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import Image from 'next/image';

interface User {
  name?: string;
  email?: string;
  picture?: string;
}

export default function Home() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const router = useRouter();

  useEffect(() => {
    fetch('/api/auth/me')
      .then(res => {
        if (res.ok) return res.json();
        throw new Error('Not authenticated');
      })
      .then(data => setUser(data.user))
      .catch(() => setUser(null))
      .finally(() => setLoading(false));
  }, []);

  if (loading) {
    return (
      <div className="flex min-h-screen items-center justify-center bg-zinc-50 dark:bg-black">
        <p className="text-zinc-600 dark:text-zinc-400">Loading...</p>
      </div>
    );
  }

  return (
    <div className="flex min-h-screen items-center justify-center bg-zinc-50 dark:bg-black">
      <main className="flex min-h-screen w-full max-w-3xl flex-col items-center justify-center gap-8 px-6">
        <div className="text-center">
          <h1 className="text-4xl font-bold tracking-tight text-black dark:text-white mb-4">
            Auth0 + Rails + Next.js
          </h1>
          <p className="text-lg text-zinc-600 dark:text-zinc-400">
            Simple authentication demo
          </p>
        </div>

        {user ? (
          <div className="flex flex-col items-center gap-6 bg-white dark:bg-zinc-900 p-8 rounded-lg shadow-lg">
            {user.picture && (
              <Image
                src={user.picture}
                alt={user.name || 'User'}
                width={80}
                height={80}
                className="rounded-full"
              />
            )}
            <div className="text-center">
              <h2 className="text-2xl font-semibold text-black dark:text-white mb-2">
                Welcome, {user.name || user.email}!
              </h2>
              {user.email && (
                <p className="text-zinc-600 dark:text-zinc-400">{user.email}</p>
              )}
            </div>
            <div className="flex flex-col sm:flex-row gap-4">
              <button
                onClick={() => router.push('/dashboard')}
                className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium"
              >
                Go to Dashboard
              </button>
              <a
                href="/api/auth/logout"
                className="px-6 py-3 bg-zinc-800 text-white rounded-lg hover:bg-zinc-700 transition-colors font-medium text-center"
              >
                Logout
              </a>
            </div>
          </div>
        ) : (
          <div className="flex flex-col items-center gap-6">
            <p className="text-zinc-600 dark:text-zinc-400">
              You are not logged in
            </p>
            <a
              href="/api/auth/login"
              className="px-8 py-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold text-lg"
            >
              Login with Auth0
            </a>
          </div>
        )}
      </main>
    </div>
  );
}
```

#### 3.7 „ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Éö„Éº„Ç∏„Çí‰ΩúÊàê
`src/app/dashboard/page.tsx`:
```typescript
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';

interface User {
  name?: string;
  email?: string;
  picture?: string;
}

interface ApiResponse {
  message?: string;
  error?: string;
}

export default function Dashboard() {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);
  const [publicData, setPublicData] = useState<ApiResponse | null>(null);
  const [privateData, setPrivateData] = useState<ApiResponse | null>(null);
  const [accessToken, setAccessToken] = useState<string | null>(null);
  const router = useRouter();

  useEffect(() => {
    fetch('/api/auth/me')
      .then(res => {
        if (!res.ok) throw new Error('Not authenticated');
        return res.json();
      })
      .then(data => {
        setUser(data.user);
        setAccessToken(data.tokens?.access_token);
      })
      .catch(() => {
        router.push('/');
      })
      .finally(() => setLoading(false));
  }, [router]);

  const testPublicApi = async () => {
    try {
      const res = await fetch('http://localhost:3001/api/v1/public');
      const data = await res.json();
      setPublicData(data);
    } catch {
      setPublicData({ error: 'Failed to fetch public API' });
    }
  };

  const testPrivateApi = async () => {
    if (!accessToken) {
      setPrivateData({ error: 'No access token available' });
      return;
    }

    try {
      const res = await fetch('http://localhost:3001/api/v1/private', {
        headers: {
          Authorization: `Bearer ${accessToken}`,
        },
      });
      const data = await res.json();
      setPrivateData(data);
    } catch {
      setPrivateData({ error: 'Failed to fetch private API' });
    }
  };

  if (loading) {
    return (
      <div className="flex min-h-screen items-center justify-center bg-zinc-50 dark:bg-black">
        <p className="text-zinc-600 dark:text-zinc-400">Loading...</p>
      </div>
    );
  }

  if (!user) {
    return null;
  }

  return (
    <div className="min-h-screen bg-zinc-50 dark:bg-black py-12 px-4">
      <div className="max-w-4xl mx-auto">
        <div className="flex justify-between items-center mb-8">
          <h1 className="text-3xl font-bold text-black dark:text-white">
            Dashboard
          </h1>
          <div className="flex gap-4">
            <button
              onClick={() => router.push('/')}
              className="px-4 py-2 text-zinc-600 dark:text-zinc-400 hover:text-black dark:hover:text-white"
            >
              Home
            </button>
            <a
              href="/api/auth/logout"
              className="px-4 py-2 bg-zinc-800 text-white rounded hover:bg-zinc-700"
            >
              Logout
            </a>
          </div>
        </div>

        <div className="space-y-6">
          <div className="bg-white dark:bg-zinc-900 p-6 rounded-lg shadow">
            <h2 className="text-xl font-semibold mb-4 text-black dark:text-white">
              User Information
            </h2>
            <div className="space-y-2 text-zinc-700 dark:text-zinc-300">
              <p><strong>Name:</strong> {user.name}</p>
              <p><strong>Email:</strong> {user.email}</p>
            </div>
          </div>

          <div className="bg-white dark:bg-zinc-900 p-6 rounded-lg shadow">
            <h2 className="text-xl font-semibold mb-4 text-black dark:text-white">
              Rails API Testing
            </h2>
            
            <div className="space-y-4">
              <div>
                <button
                  onClick={testPublicApi}
                  className="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700 mb-2"
                >
                  Test Public API
                </button>
                {publicData && (
                  <div className="bg-zinc-100 dark:bg-zinc-800 p-4 rounded">
                    <pre className="text-sm text-zinc-800 dark:text-zinc-200">
                      {JSON.stringify(publicData, null, 2)}
                    </pre>
                  </div>
                )}
              </div>

              <div>
                <button
                  onClick={testPrivateApi}
                  className="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 mb-2"
                >
                  Test Private API (Authenticated)
                </button>
                {privateData && (
                  <div className="bg-zinc-100 dark:bg-zinc-800 p-4 rounded">
                    <pre className="text-sm text-zinc-800 dark:text-zinc-200">
                      {JSON.stringify(privateData, null, 2)}
                    </pre>
                  </div>
                )}
              </div>
            </div>
          </div>

          {accessToken && (
            <div className="bg-white dark:bg-zinc-900 p-6 rounded-lg shadow">
              <h2 className="text-xl font-semibold mb-4 text-black dark:text-white">
                Access Token
              </h2>
              <div className="bg-zinc-100 dark:bg-zinc-800 p-4 rounded break-all text-sm text-zinc-800 dark:text-zinc-200">
                {accessToken}
              </div>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}
```

#### 3.8 Next.js„Çµ„Éº„Éê„ÉºËµ∑Âãï
```bash
npm run dev
```

### Phase 4: Âãï‰ΩúÁ¢∫Ë™ç

1. **„Éñ„É©„Ç¶„Ç∂„Åß„Ç¢„ÇØ„Çª„Çπ**: http://localhost:3000
2. **„ÄåLogin with Auth0„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ**
3. **Auth0„ÅÆ„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÅßË™çË®º**
4. **„Éõ„Éº„É†„Éö„Éº„Ç∏„Å´„É™„ÉÄ„Ç§„É¨„ÇØ„Éà**„Åï„Çå„Å¶„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÅåË°®Á§∫„Åï„Çå„Çã
5. **„ÄåGo to Dashboard„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ**
6. **„ÄåTest Public API„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ** ‚Üí ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÅåË°®Á§∫„Åï„Çå„Çã
7. **„ÄåTest Private API„Äç„Çí„ÇØ„É™„ÉÉ„ÇØ** ‚Üí JWTË™çË®ºÂæå„Å´ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏„ÅåË°®Á§∫„Åï„Çå„Çã

## üîê How It Works

### Authentication Flow

```
1. „É¶„Éº„Ç∂„Éº„Åå„Éõ„Éº„É†„Éö„Éº„Ç∏„Å´„Ç¢„ÇØ„Çª„Çπ
   ‚Üì
2. „ÄåLogin with Auth0„Äç„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
   ‚Üì
3. /api/auth/login „Å´„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
   ‚Üì
4. Auth0„ÅÆË™çË®º„Éö„Éº„Ç∏„Å∏ (audience‰ªò„Åç)
   ‚Üì
5. Ë™çË®ºÊàêÂäü
   ‚Üì
6. /api/auth/callback „Å∏Êàª„Çã
   ‚Üì
7. Ë™çÂèØ„Ç≥„Éº„Éâ„Çí„Éà„Éº„ÇØ„É≥„Å´‰∫§Êèõ
   ‚Üì
8. access_token„Å®id_token„ÇíÂèñÂæó
   ‚Üì
9. HTTP-only cookie„Å´‰øùÂ≠ò
   ‚Üì
10. „Éõ„Éº„É†„Éö„Éº„Ç∏„Å∏„É™„ÉÄ„Ç§„É¨„ÇØ„Éà
```

### API Authentication

**Frontend ‚Üí Rails:**
```typescript
fetch('http://localhost:3001/api/v1/private', {
  headers: {
    Authorization: `Bearer ${accessToken}`
  }
})
```

**Rails JWT Validation:**
- Auth0„ÅÆÂÖ¨ÈñãÈçµÔºàJWKSÔºâ„Çí‰ΩøÁî®„Åó„Å¶„Éà„Éº„ÇØ„É≥„ÅÆÁΩ≤Âêç„ÇíÊ§úË®º
- issuer (iss) „Å® audience (aud) „ÇíÊ§úË®º
- „Éà„Éº„ÇØ„É≥„ÅÆÊúâÂäπÊúüÈôê„ÇíÁ¢∫Ë™ç

## üõ†Ô∏è Technologies

| Layer | Technology | Version |
|-------|-----------|---------|
| **Frontend** | Next.js | 16.0.0 |
| | React | 19.2.0 |
| | TypeScript | ^5 |
| | Tailwind CSS | ^4 |
| **Backend** | Rails | 8.1.0 |
| | Ruby | 3.3.9+ |
| | SQLite | 3 |
| **Auth** | Auth0 | - |
| | JWT | 3.1.2 |
| **Dev Tools** | dotenv-rails | 3.1.8 |
| | rack-cors | 3.0.0 |

## üìù API Endpoints

### Frontend (Next.js)
| Endpoint | Description |
|----------|-------------|
| `GET /api/auth/login` | Auth0„É≠„Ç∞„Ç§„É≥„ÇíÈñãÂßã |
| `GET /api/auth/callback` | Auth0Ë™çË®º„Ç≥„Éº„É´„Éê„ÉÉ„ÇØ |
| `GET /api/auth/logout` | „É≠„Ç∞„Ç¢„Ç¶„ÉàÂá¶ÁêÜ |
| `GET /api/auth/me` | ÁèæÂú®„ÅÆ„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÇíÂèñÂæó |

### Backend (Rails)
| Endpoint | Auth Required | Description |
|----------|--------------|-------------|
| `GET /api/v1/public` | ‚ùå | ÂÖ¨Èñã„Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà |
| `GET /api/v1/private` | ‚úÖ | ‰øùË≠∑„Åï„Çå„Åü„Ç®„É≥„Éâ„Éù„Ç§„É≥„ÉàÔºàJWTÂøÖÈ†àÔºâ |

## üêõ Troubleshooting

### „Çà„Åè„ÅÇ„ÇãÂïèÈ°å„Å®Ëß£Ê±∫ÊñπÊ≥ï

#### 1. CORS „Ç®„É©„Éº
**ÁóáÁä∂**: „Éñ„É©„Ç¶„Ç∂„Ç≥„É≥„ÇΩ„Éº„É´„Å´ `CORS policy` „Ç®„É©„Éº

**Ëß£Ê±∫**:
- Rails„ÅÆ `.env` „Åß `FRONTEND_URL=http://localhost:3000` „ÇíÁ¢∫Ë™ç
- `config/initializers/cors.rb` „ÅÆË®≠ÂÆö„ÇíÁ¢∫Ë™ç
- Rails„Çµ„Éº„Éê„Éº„ÇíÂÜçËµ∑Âãï

#### 2. JWTÊ§úË®º„Ç®„É©„Éº: Invalid issuer
**ÁóáÁä∂**: `Expected ["https://..."], received https://.../`

**Ëß£Ê±∫**: `json_web_token.rb` „Åß issuer „Å´ÈÖçÂàó„Çí‰ΩøÁî®:
```ruby
iss: [auth0_issuer, "#{auth0_issuer}/"],
```

#### 3. SSLË®ºÊòéÊõ∏„Ç®„É©„Éº
**ÁóáÁä∂**: `SSL_connect returned=1 errno=0`

**Ëß£Ê±∫**: `json_web_token.rb` „ÅßÈñãÁô∫Áí∞Â¢É„Åß„ÅØSSLÊ§úË®º„Çí„Çπ„Ç≠„ÉÉ„Éó:
```ruby
http.verify_mode = Rails.env.production? ? OpenSSL::SSL::VERIFY_PEER : OpenSSL::SSL::VERIFY_NONE
```

#### 4. Áí∞Â¢ÉÂ§âÊï∞„ÅåË™≠„ÅøËæº„Åæ„Çå„Å™„ÅÑ
**ÁóáÁä∂**: `AUTH0_DOMAIN` „Åå `nil`

**Ëß£Ê±∫**:
```bash
# Gemfile„Å´ËøΩÂä†
gem "dotenv-rails", groups: [:development, :test]

# „Ç§„É≥„Çπ„Éà„Éº„É´
bundle install

# „Çµ„Éº„Éê„ÉºÂÜçËµ∑Âãï
```

#### 5. Auth0 callback URL„Ç®„É©„Éº
**ÁóáÁä∂**: Auth0„Åã„Çâ `Callback URL mismatch`

**Ëß£Ê±∫**: Auth0„ÉÄ„ÉÉ„Ç∑„É•„Éú„Éº„Éâ„Åß‰ª•‰∏ã„ÇíÁ¢∫Ë™ç:
- Allowed Callback URLs: `http://localhost:3000/api/auth/callback`
- Ê≠£Á¢∫„Å´‰∏ÄËá¥„Åó„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™çÔºàÊú´Â∞æ„Çπ„É©„ÉÉ„Ç∑„É•„Å™„ÅóÔºâ

## üìÑ Áí∞Â¢ÉÂ§âÊï∞‰∏ÄË¶ß

### Backend (.env)
```bash
# Auth0 settings (domain without https://)
AUTH0_DOMAIN=dev-xxx.auth0.com
AUTH0_API_IDENTIFIER=https://my-rails-api

# Frontend URL for CORS
FRONTEND_URL=http://localhost:3000
```

### Frontend (.env.local)
```bash
# Auth0 Configuration
AUTH0_DOMAIN=dev-xxx.auth0.com
AUTH0_CLIENT_ID=abc123...
AUTH0_CLIENT_SECRET=xyz789...
AUTH0_BASE_URL=http://localhost:3000
AUTH0_AUDIENCE=https://my-rails-api

# Backend API URL
NEXT_PUBLIC_API_URL=http://localhost:3001
```

## üöÄ Êú¨Áï™Áí∞Â¢É„Å∏„ÅÆ„Éá„Éó„É≠„Ç§

### 1. Êñ∞„Åó„ÅÑAuth0„ÉÜ„Éä„É≥„Éà„Çí‰ΩúÊàêÔºàÊé®Â•®Ôºâ
```
Production Tenant: prod-myapp.auth0.com
```

### 2. Áí∞Â¢ÉÂ§âÊï∞„ÇíÊú¨Áï™Áî®„Å´Êõ¥Êñ∞
```bash
# Backend
AUTH0_DOMAIN=prod-myapp.auth0.com
FRONTEND_URL=https://yourdomain.com

# Frontend  
AUTH0_BASE_URL=https://yourdomain.com
AUTH0_AUDIENCE=https://api.yourdomain.com
```

### 3. Auth0 ApplicationË®≠ÂÆö„ÇíÊõ¥Êñ∞
```
Allowed Callback URLs:
https://yourdomain.com/api/auth/callback

Allowed Logout URLs:
https://yourdomain.com

Allowed Web Origins:
https://yourdomain.com
```

## üìö ÂèÇËÄÉ„É™„É≥„ÇØ

- [Auth0 Documentation](https://auth0.com/docs)
- [Next.js Documentation](https://nextjs.org/docs)
- [Rails Guides](https://guides.rubyonrails.org/)
- [JWT.io](https://jwt.io/)

## üìÑ License

MIT

---

**‰ΩúÊàêÊó•**: 2025Âπ¥10Êúà24Êó•  
**Auth0 + Rails + Next.js „Å´„Çà„ÇãÁ∞°Âçò„Å™Ë™çË®º„Ç∑„Çπ„ÉÜ„É†„ÅÆÂÆüË£Ö‰æã**
